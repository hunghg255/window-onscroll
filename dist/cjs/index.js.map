{"version":3,"file":"index.js","sources":["../../src/index.ts"],"sourcesContent":["/* eslint-disable unicorn/prefer-module */\n/* eslint-disable unicorn/no-this-assignment */\n/* eslint-disable @typescript-eslint/no-this-alias */\n/* eslint-disable unicorn/no-null */\n// @ts-nocheck\n\nclass ScrollManager {\n  private instance = null;\n  private instancesCount = 0;\n  private ticking = false;\n  private supportsPassiveEvents = false;\n  private supportsCustomEvents = false;\n  private eventListenerOptions = null;\n\n  private EVENT_NAME = 'window-onscroll';\n\n  private isWindowDefined: any;\n\n  constructor() {\n    this.init();\n  }\n\n  private init() {\n    this.isWindowDefined = typeof window !== 'undefined';\n    this.supportsPassiveEvents = this.detectPassiveEvents();\n    this.supportsCustomEvents = this.isWindowDefined && typeof window.CustomEvent === 'function';\n\n    if (typeof window === 'undefined') {\n      // Silently return null if it is used on server\n      return null;\n    }\n\n    // Increase reference count\n    this.instancesCount++;\n\n    // If singleton instance exists, return it rather than creating a new one\n    if (this.instance) {\n      return this.instance;\n    }\n\n    // Save singleton instance\n    // @ts-ignore\n    this.instance = this;\n\n    // Bind handlers\n    this.handleScroll = this.handleScroll.bind(this);\n\n    // Use passive listener when supported with fallback to capture option\n    // @ts-ignore\n    this.eventListenerOptions = this.supportsPassiveEvents ? { passive: true } : true;\n\n    // Add scroll listener\n    // @ts-ignore\n    window.addEventListener('scroll', this.handleScroll, this.eventListenerOptions);\n  }\n\n  public removeListener() {\n    this.instancesCount--;\n\n    // There is not components listening to our event\n    if (this.instancesCount === 0) {\n      this.destroy();\n    }\n  }\n\n  private destroy() {\n    // Remove event listener\n    // @ts-ignore\n    window.removeEventListener('scroll', this.handleScroll, this.eventListenerOptions);\n\n    // Clear singleton instance and count\n    this.instance = null;\n    this.instancesCount = 0;\n  }\n\n  public getScrollPosition() {\n    // Get scroll position, with IE fallback\n    let scrollPositionY = window.scrollY || document.documentElement.scrollTop;\n    let scrollPositionX = window.scrollX || document.documentElement.scrollLeft;\n\n    // Disable overscrolling in safari\n    if (scrollPositionY < 0) {\n      scrollPositionY = 0;\n    }\n    if (scrollPositionX < 0) {\n      scrollPositionX = 0;\n    }\n\n    return {\n      // Alias for scrollPositionY for backwards compatibility\n      scrollPosition: scrollPositionY,\n      scrollPositionY,\n      scrollPositionX,\n    };\n  }\n\n  private handleScroll() {\n    // Fire the event only once per requestAnimationFrame\n    const _self = this;\n    if (!this.ticking) {\n      _self.ticking = true;\n\n      let event;\n\n      if (_self.supportsCustomEvents) {\n        event = new CustomEvent(_self.EVENT_NAME, {\n          detail: _self.getScrollPosition(),\n        });\n      } else {\n        event = document.createEvent('CustomEvent');\n        event.initCustomEvent(_self.EVENT_NAME, false, false, _self.getScrollPosition());\n      }\n\n      window.dispatchEvent(event);\n\n      window.requestAnimationFrame(function () {\n        _self.ticking = false;\n      });\n    }\n  }\n\n  private detectPassiveEvents() {\n    if (this.isWindowDefined && typeof window.addEventListener === 'function') {\n      let passive = false;\n      const options = Object.defineProperty({}, 'passive', {\n        get: function () {\n          passive = true;\n        },\n      });\n      // note: have to set and remove a no-op listener instead of null\n      // (which was used previously), because Edge v15 throws an error\n      // when providing a null callback.\n      // https://github.com/rafrex/detect-passive-events/pull/3\n      const noop = function () {};\n      window.addEventListener('TEST_PASSIVE_EVENT_SUPPORT', noop, options);\n      window.removeEventListener('TEST_PASSIVE_EVENT_SUPPORT', noop, options);\n\n      return passive;\n    }\n\n    return false;\n  }\n}\n\nif (typeof window !== 'undefined') {\n  window.ScrollManager = ScrollManager;\n}\n\nexport default ScrollManager;\n"],"names":["ScrollManager","this","instance","instancesCount","ticking","supportsPassiveEvents","supportsCustomEvents","eventListenerOptions","EVENT_NAME","init","prototype","isWindowDefined","window","detectPassiveEvents","CustomEvent","handleScroll","bind","passive","addEventListener","removeListener","destroy","removeEventListener","getScrollPosition","scrollPositionY","scrollY","document","documentElement","scrollTop","scrollPositionX","scrollX","scrollLeft","scrollPosition","event_1","_self","detail","createEvent","initCustomEvent","dispatchEvent","requestAnimationFrame","passive_1","options","Object","defineProperty","get","noop"],"mappings":"AAMA,IAAAA,EAAA,WAYE,SAAAA,IAXQC,KAAQC,SAAG,KACXD,KAAcE,eAAG,EACjBF,KAAOG,SAAG,EACVH,KAAqBI,uBAAG,EACxBJ,KAAoBK,sBAAG,EACvBL,KAAoBM,qBAAG,KAEvBN,KAAUO,WAAG,kBAKnBP,KAAKQ,MACN,CA0HH,OAxHUT,EAAAU,UAAAD,KAAR,WAKE,OAJAR,KAAKU,gBAAoC,oBAAXC,OAC9BX,KAAKI,sBAAwBJ,KAAKY,sBAClCZ,KAAKK,qBAAuBL,KAAKU,iBAAiD,mBAAvBC,OAAOE,YAE5C,oBAAXF,OAEF,MAITX,KAAKE,iBAGDF,KAAKC,SACAD,KAAKC,UAKdD,KAAKC,SAAWD,KAGhBA,KAAKc,aAAed,KAAKc,aAAaC,KAAKf,MAI3CA,KAAKM,sBAAuBN,KAAKI,uBAAwB,CAAEY,SAAS,QAIpEL,OAAOM,iBAAiB,SAAUjB,KAAKc,aAAcd,KAAKM,yBAGrDP,EAAAU,UAAAS,eAAP,WACElB,KAAKE,iBAGuB,IAAxBF,KAAKE,gBACPF,KAAKmB,WAIDpB,EAAAU,UAAAU,QAAR,WAGER,OAAOS,oBAAoB,SAAUpB,KAAKc,aAAcd,KAAKM,sBAG7DN,KAAKC,SAAW,KAChBD,KAAKE,eAAiB,GAGjBH,EAAAU,UAAAY,kBAAP,WAEE,IAAIC,EAAkBX,OAAOY,SAAWC,SAASC,gBAAgBC,UAC7DC,EAAkBhB,OAAOiB,SAAWJ,SAASC,gBAAgBI,WAUjE,OAPIP,EAAkB,IACpBA,EAAkB,GAEhBK,EAAkB,IACpBA,EAAkB,GAGb,CAELG,eAAgBR,EAChBA,gBAAeA,EACfK,gBAAeA,IAIX5B,EAAAU,UAAAK,aAAR,WAEE,IAIMiB,EAJAC,EAAQhC,KACTA,KAAKG,UACR6B,EAAM7B,SAAU,EAIZ6B,EAAM3B,qBACR0B,EAAQ,IAAIlB,YAAYmB,EAAMzB,WAAY,CACxC0B,OAAQD,EAAMX,uBAGhBU,EAAQP,SAASU,YAAY,gBACvBC,gBAAgBH,EAAMzB,YAAY,GAAO,EAAOyB,EAAMX,qBAG9DV,OAAOyB,cAAcL,GAErBpB,OAAO0B,uBAAsB,WAC3BL,EAAM7B,SAAU,CAClB,MAIIJ,EAAAU,UAAAG,oBAAR,WACE,GAAIZ,KAAKU,iBAAsD,mBAA5BC,OAAOM,iBAAiC,CACzE,IAAIqB,GAAU,EACRC,EAAUC,OAAOC,eAAe,CAAA,EAAI,UAAW,CACnDC,IAAK,WACHJ,GAAU,CACX,IAMGK,EAAO,aAIb,OAHAhC,OAAOM,iBAAiB,6BAA8B0B,EAAMJ,GAC5D5B,OAAOS,oBAAoB,6BAA8BuB,EAAMJ,GAExDD,CACR,CAED,OAAO,GAEVvC,CAAD,IAEsB,oBAAXY,SACTA,OAAOZ,cAAgBA"}